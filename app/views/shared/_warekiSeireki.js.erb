<% content_for(:after_js) do %>
  <%= javascript_tag do %>
    document.addEventListener("DOMContentLoaded", () => {

      const radioBtnWrappers = document.querySelectorAll("[data-name='yearTypes'] p");
      const foundedDateDummy = document.querySelector('#foundedDateDummy');
      const now = new Date();

      foundedDateDummy.setAttribute('max', now.getFullYear());
      radioBtnWrappers.forEach(btn => btn.addEventListener('click', handleClick));
      foundedDateDummy.addEventListener('input', handleInput);

      function handleClick(e) {
        const pseudoRadios = document.querySelectorAll("[data-type='pseudoRadio']");
        pseudoRadios.forEach(btn => btn.classList.remove('checked'));
        e.currentTarget.querySelector("[data-type='pseudoRadio']").classList.add('checked');
      }

      function handleInput(e) {
        const foundedDateReal = document.querySelector('#carrier_founded_date_year');
        const checkedBtn = document.querySelector("[data-type='pseudoRadio'].checked");
        const yearType = checkedBtn.dataset.yeartype;
        const yearInput = Number(foundedDateDummy.value);
        foundedDateReal.value = getGregorianYear(yearType, yearInput);
      }

      function getGregorianYear(yearType, yearInput) {
        console.log({yearType, yearInput});
        if ((yearType === "平成") && (yearInput > 0)) {
            year = (yearInput + 1988);
        } else if ((yearType === "昭和") && (yearInput > 0) && (yearInput <= 64)) {
            year = (yearInput + 1925);
        } else if ((yearType === "大正") && (yearInput > 0) && (yearInput <= 15)) {
            year = (yearInput + 1911);
        } else if ((yearType === "明治") && (yearInput > 0) && (yearInput <= 45)) {
            year = (yearInput + 1867);
        } else {
            year = "指定の和暦年は存在しません";
        }
        return year;
      }

    });
  <% end %>
<% end %>